---
SPMI
---

------

# SPMI

[TOC]

------

## 1.SPMI协议定义

### 1.1 定义

-   **地址帧（Address Frame）**：由***9位***组成的序列，其中***8位表示地址信息，1位为奇偶校验位***。
-   **总线仲裁（Bus Arbitration）**：总线仲裁是指将***总线分配给一个设备***以发送序列的过程。
-   **总线移交（Bus Handover）**：总线所有权从当前***总线主控器（BOM）***转移到下一个总线主控器的过程。
-   **总线空闲（Bus Idle）**：当在***序列结束和总线仲裁开始之间***，***SCLK***和***SDATA***信号都处于***逻辑零电平***时，SPMI总线处于***空闲状态***。
-   **总线主控器（Bus Owner Master）**：在总线上发送***最近序列***并为后续总线仲裁提供***SCLK时钟***的主控器。
-   **总线驻留周期（Bus Park Cycle）**：当***SDATA信号控制权***在序列期间或结束时可能在设备间切换时出现的***单个时钟周期***。
-   **命令帧（Command Frame）**：由***13位***组成的序列，其中***4位表示SPMI主控器或从设备地址***，***8位表示SPMI命令***，***1位为奇偶校验位***。
-   **命令序列（Command Sequence）**：序列的一部分，包括***序列起始条件（SSC）***、***命令帧***、***数据帧***和***总线驻留周期***。
-   **连接主控器（Connected Master）**：具有***主控器优先级等级***并能够在***已初始化总线***上启动命令序列的主控器。
-   **数据帧（Data Frame）**：由***9位***组成的序列，其中***8位为数据***，***1位为奇偶校验位***。
-   **断开主控器（Disconnected Master）**：***不更新其主控器优先级等级***且***不在总线上发送或响应序列***的主控器。
-   **组从设备ID（Group Slave ID）**：分配给***一个或多个从设备***的***4位编号***，用于在SPMI总线上将它们标识为一个组。
-   **已初始化总线（Initialized Bus）**：当***存在总线主控器***时，SPMI总线被认为是***已初始化***的。
-   **主控器（Master）**：SPMI总线上能够***驱动SCLK线***、***参与多主控器仲裁***并支持传输所有主控器特定序列的设备。
-   **主控器仲裁（Master Arbitration）**：主控器设备之间进行总线仲裁以将***SPMI总线分配给一个主控器***的阶段。
-   **主控器ID（Master ID）**：分配给SPMI主控器的***唯一2位编号***，用于在总线上标识该主控器。
-   **主控器优先级等级（Master Priority Level）**：分配给每个主控器的编号，***决定授予总线所有权的顺序***。
-   **非请求能力从设备（Non-Request Capable Slave）**：***无法执行从设备仲裁***或***发送序列***的从设备。
-   **序列（Sequence）**：SPMI总线上的***总线事务***，以***总线仲裁开始***，包含***SSC***、***命令帧***、可能的***数据帧和地址帧***，并以***总线驻留周期结束***。序列可以由***主控器***或***具有请求能力的从设备***传输。
-   **从设备（Slave）**：SPMI总线上***无法驱动SCLK线***的设备，即***非主控器设备***。
-   **从设备仲裁（Slave Arbitration）**：具有请求能力的从设备之间进行总线仲裁以将***SPMI总线分配给一个具有请求能力的从设备***的阶段。
-   **从设备ID（Slave ID）**：分配给SPMI从设备的***4位编号***，可以是***唯一从设备ID***或***组从设备ID***。
-   **具有请求能力的从设备（Request Capable Slave）**：总线上***非主控器***但能够***请求和参与总线仲裁***并***发送序列***的设备。
-   **未初始化总线（Uninitialized Bus）**：当***没有总线主控器***时，SPMI总线被认为是***未初始化***的。
-   **唯一从设备ID（Unique Slave ID）**：分配给SPMI从设备的***唯一4位编号***，用于在总线上标识该从设备。

## 2. SPMI概述

​		***系统电源管理接口（SPMI）是一个双线串行接口***，用于连接片上系统（SoC）处理器系统的***集成电源控制器（PC）与一个或多个电源管理集成电路（PMIC）***动态调整SoC内部电压域的***供电和衬底偏压电压***。

​		在PC内部，SPMI相关功能被称为***"主控器（Master）"***。在PMIC内部，SPMI相关功能被称为***"从设备（Slave）"***。单个SPMI总线上最多可有***4个主控器设备***和***16个从设备***。多个SPMI主控器和从设备可以位于***单个IC上***、***多个独立IC上***或***两者的任意组合***。

​		能够在SPMI总线上***发起序列***的从设备被称为***具有请求能力的从设备（RCS）***。不能发起序列的从设备被称为***非请求能力从设备（NRCS）***。

​		本规范定义了***操作状态***、***命令集***、***物理接口***以及SPMI总线上SPMI设备间***数据通信协议***，以确保命令和数据传输的兼容性。SPMI命令序列集包括***从设备和主控器寻址***、***从设备操作状态控制***、***主控器和从设备的寄存器读写***，以及支持***MIPI设备描述符块数据读取***和***总线管理***的命令。

### 2.1 系统概述

​		***最小系统配置***包含两个SPMI设备，其中一个必须是***SPMI主控器设备***。

​		更复杂的系统可能包括***最多4个独立的SoC***，配备***最多4个SPMI主控器***。最多***16个逻辑从设备***可以连接到这些主控器设备。从设备可以位于***一个或多个物理设备***上。从设备可以为SoC提供***供电电压***或执行通过SPMI控制的***其他功能***。图1显示了一个SPMI系统示例。

![image-20250620201738816](.\assets\image-20250620201738816.png)

### 2.2 SPMI协议概述

​		SPMI协议具有以下特性：

​				• **总线仲裁** - SPMI使用***总线仲裁过程***在***主控器设备***和***具有请求能力的从设备***之间分配总线流量。

​				• **主控器连接和断开** - 主控器连接到***已初始化***或***未初始化SPMI总线***以及从中断开的过程。

​				• **从设备发起的通信** - ***具有请求能力的从设备***向主控器或其他从设备***发起序列***的过程。

​		SPMI协议具有以下要求：

​				• **枚举** - 每个***主控器或从设备***都需要一个***唯一标识符***来使用SPMI进行通信。

​				• **SPMI主控器要求** - SPMI主控器需要支持第11节和第13节中定义的***最小功能集***。

​				• **SPMI从设备要求** - SPMI从设备需要支持第12节和第13节中定义的***最小功能集***。

## 3. 物理接口

### 3.1 I/O结构

​		SPMI是SPMI设备之间的***双线接口***，具有两个信号：一个***串行双向数据信号（SDATA）\**\*和一个由\**\*SPMI主控器控制***的***时钟信号（SCLK）***。

​		***图2显示了主控器和从设备的数据信号所需的I/O结构。***

![image-20250620202423646](.\assets\image-20250620202423646.png)

​		***图 3 展示了主设备和从设备的时钟信号所需的输入/输出结构。***

![image-20250620202506700](.\assets\image-20250620202506700.png)

### 3.2 SPMI I/O 配置与电气特性

#### 3.2.1 多从设备和主设备的 I/O 配置

##### 系统拓扑结构

-   **逻辑从设备数量**：SPMI 规范支持最多连接 **16个逻辑从设备**
-   **物理从设备分布**：这16个逻辑从设备可分布在单个或多个物理从设备IC上
-   **主设备数量**：通过总线仲裁，单个总线上最多支持 **4个主设备**

##### 物理接口规格

每个物理从设备包含：

-   **SCLK输入**：时钟信号输入端
-   **SDATA双向接口**：数据信号双向传输端

##### 下拉电阻配置

下拉电阻位置

-   各物理从设备的I/O单元内部可集成下拉电阻
-   也可通过外部电路提供下拉电阻

##### 下拉电阻规格要求

| 参数类型       | 信号线 | 最小值 (MΩ) | 最大值 (MΩ) |
| -------------- | ------ | ----------- | ----------- |
| **SPMI从设备** | SDATA  | 0.5         | 2.0         |
| **SPMI从设备** | SCLK   | 0.5         | 2.0         |
| **整体系统**   | SDATA  | 0.125       | 2.0         |
| **整体系统**   | SCLK   | 0.125       | 2.0         |

##### 重要设计考虑

>   ⚠️ **注意**：当连接到总线的物理从设备数量超过4个时，应调整各个从设备的下拉电阻数量，以确保整个系统的下拉电阻满足规格要求。

##### 设备连接方式

-   **并行连接**：不同的物理从设备并行连接到总线上
-   **资源共享**：同一物理从设备内部的所有逻辑从设备共享该物理设备的通用I/O结构

#### 3.2.2 输入/输出电压和逻辑电平

##### 信号特性

SCLK和SDATA信号具有以下特征：

-   **信号类型**：类似CMOS的信号

-   信号模式

    ：

    -   单端信号
    -   接地参考
    -   轨到轨电压
    -   电压模式信号

##### 电气规格参考

-   **参考电压**：所有电气规格相对于I/O电源电压 **VDD** 给出
-   **信号电平一致性**：SCLK和SDATA端子必须使用相同的信号电平

##### 外部控制信号

对于从设备上可能存在的外部控制和状态信号，其电平规格：

-   **使能信号（Enable）**
-   **复位信号（Reset）**
-   **电源正常信号（Power Good）**

>   📝 **说明**：这些外部信号的电平由用户根据具体应用需求自行定义。






















# 台球游戏

## 项目结构

```
billiards/
├── index.html              # 主HTML文件
├── game.js                 # 主游戏文件
├── style.css               # 样式文件
├── js/                     # 模块化文件夹
│   ├── config.js          # 配置管理模块
│   ├── ball.js            # Ball 类模块
│   ├── physics.js         # 物理引擎模块
│   ├── renderer.js        # 渲染器模块
│   └── input.js           # 输入处理模块
└── README.md              # 本文件
```

## 模块化架构优势

### 🏗️ 架构改进

- **关注点分离**：物理、渲染、输入、配置各自独立
- **可维护性**：单一职责，易于调试和扩展
- **可重用性**：模块可在其他项目中复用
- **ES6 模块**：原生浏览器支持，无需打包工具

### 📦 模块说明

#### 1. **config.js** - 配置中心

- 物理参数（摩擦力、重力、碰撞恢复系数）
- 球袋参数（半径、吸引力）
- 台球杆参数（最大拉杆距离、最大力度）
- 调试颜色配置
- 预测计算步数配置

#### 2. **ball.js** - 球类实体

- Ball 类定义和物理更新
- 碰撞检测逻辑
- 球袋吸引力计算
- 台边碰撞处理
- 球的绘制（实心球、条纹球、白球）

#### 3. **physics.js** - 物理引擎

- 球与球的碰撞检测和解决
- 进袋检测和处理
- 轨迹预测算法
- 目标球击中后的路径计算

#### 4. **renderer.js** - 渲染系统

- 台球桌绘制（桌面、台边、球袋）
- 台球杆可视化
- 力度指示器
- 预测路径显示
- 调试信息覆盖

#### 5. **input.js** - 输入处理

- 鼠标事件处理（拖拽瞄准）
- 键盘快捷键（调试模式切换）
- 击球力度计算
- 击球偏移效果

#### 6. **game-modular.js** - 游戏协调器

- 游戏主循环
- 模块间通信
- 游戏状态管理
- 公共接口提供

## 🎯 游戏特性

### 物理系统

- ✅ 真实的球与球碰撞
- ✅ 台边反弹效果
- ✅ 摩擦力减速
- ✅ 球袋吸引力
- ✅ 击球偏移和旋转效果

### 视觉效果

- ✅ 高质量球的渲染（实心球/条纹球）
- ✅ 台球杆可视化（木质纹理、装饰环、皮头）
- ✅ 力度指示条（渐变色彩）
- ✅ 球袋真实材质（渐变、网格纹理）
- ✅ 台面纹理

### 预测系统

- ✅ 白球轨迹预测
- ✅ 目标球击中后的轨迹预测
- ✅ 碰撞点高亮显示
- ✅ 进袋可能性提示

### 调试功能

- ✅ 速度向量可视化
- ✅ FPS 显示
- ✅ 进球统计
- ✅ 实时调试切换（D 键）

## 🚀 使用方式

```html
<!-- ES6 模块方式 -->
<script type="module" src="game.js"></script>
```

## 📊 代码统计

| 文件           | 行数     | 职责                  |
| -------------- | -------- | --------------------- |
| game.js        | 246      | 主游戏协调器          |
| ball.js        | 180      | 球类实体              |
| physics.js     | 320      | 物理引擎              |
| renderer.js    | 280      | 渲染系统              |
| input.js       | 200      | 输入处理              |
| config.js      | 55       | 配置管理              |
| **总计模块化** | **1141** | **平均每文件 163 行** |

## 🎮 操作指南

1. **瞄准**：点击白球附近拖拽鼠标
2. **击球**：松开鼠标释放台球杆
3. **力度**：拖拽距离决定击球力度
4. **预测**：拖拽时显示轨迹预测线
5. **调试**：按 D 键或勾选调试模式

## 🔧 扩展建议

### 新增功能模块

- **sound.js** - 音效系统
- **ai.js** - AI 对手
- **rules.js** - 游戏规则引擎
- **network.js** - 多人联机

### 性能优化

- 使用 Web Workers 进行物理计算
- 实现对象池减少 GC
- Canvas 离屏渲染优化

### 现代工具链

- TypeScript 类型安全
- Webpack/Vite 打包优化
- Jest 单元测试
- ESLint 代码规范

## 🏆 总结

这是一个采用模块化架构的台球游戏，将代码拆分为 6 个专职模块，每个模块平均约 200 行，具有以下优势：

- **可读性** - 单一职责更清晰
- **可维护性** - 独立模块易于修改
- **可扩展性** - 新功能易于添加
- **可测试性** - 模块化便于单元测试

游戏具备完整的台球物理效果，包括真实碰撞、轨迹预测、球袋吸引等特性，为后续扩展奠定了坚实基础。

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°çƒæ¸¸æˆ - ç¢°æ’è°ƒè¯•ç‰ˆ</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-width: 300px;
            z-index: 1000;
        }
        .debug-panel h3 {
            margin: 0 0 10px 0;
            color: #4CAF50;
        }
        .debug-row {
            display: flex;
            justify-content: space-between;
            margin: 2px 0;
        }
        .debug-value {
            color: #FFD700;
        }
        .error-log {
            background: rgba(255,0,0,0.2);
            border: 1px solid #ff6666;
            color: #ffcccc;
            margin-top: 10px;
            padding: 5px;
            border-radius: 3px;
            max-height: 100px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="debug-panel" id="debugPanel">
        <h3>ğŸ± ç¢°æ’è°ƒè¯•é¢æ¿</h3>
        <div class="debug-row">
            <span>æ¸¸æˆçŠ¶æ€:</span>
            <span class="debug-value" id="gameStatus">åŠ è½½ä¸­...</span>
        </div>
        <div class="debug-row">
            <span>å½“å‰å¸§:</span>
            <span class="debug-value" id="currentFrame">0</span>
        </div>
        <div class="debug-row">
            <span>ç™½çƒé€Ÿåº¦:</span>
            <span class="debug-value" id="cueBallVel">0,0</span>
        </div>
        <div class="debug-row">
            <span>æ´»åŠ¨çƒæ•°:</span>
            <span class="debug-value" id="activeBalls">0</span>
        </div>
        <div class="debug-row">
            <span>ç¢°æ’æ£€æµ‹:</span>
            <span class="debug-value" id="collisionCount">0</span>
        </div>
        <div class="debug-row">
            <span>æœ€åç¢°æ’:</span>
            <span class="debug-value" id="lastCollision">æ— </span>
        </div>
        <div class="error-log" id="errorLog" style="display: none;">
            <div style="font-weight: bold; color: #ff6666;">é”™è¯¯æ—¥å¿—:</div>
            <div id="errorMessages"></div>
        </div>
    </div>

    <div class="game-container">
        <h1>å°çƒæ¸¸æˆ - ç¢°æ’è°ƒè¯•ç‰ˆ</h1>
        <canvas id="gameCanvas" width="1600" height="700"></canvas>
        <div class="controls">
            <div class="power-label">åŠ›åº¦:</div>
            <div class="power-bar">
                <div class="power-fill" id="powerFill"></div>
            </div>
            <button class="restart-btn" onclick="if(window.game) game.restart()">é‡æ–°å¼€å§‹</button>
            <div class="status">
                <div>å·²è¿›çƒ: <span id="pottedBalls">æ— </span></div>
                <div>FPS: <span id="fpsDisplay">--</span></div>
                <label class="debug-label"><input type="checkbox" id="debugToggle" checked> è°ƒè¯•ä¿¡æ¯</label>
            </div>
            <div class="instructions">
                <strong>ç¢°æ’è°ƒè¯•ç‰ˆæœ¬</strong><br>
                å¦‚æœå‡ºç°å¡æ­»ï¼Œè¯·è§‚å¯Ÿå³ä¾§è°ƒè¯•é¢æ¿<br>
                æ³¨æ„ç™½çƒé€Ÿåº¦å’Œç¢°æ’è®¡æ•°çš„å˜åŒ–
            </div>
        </div>
    </div>

    <script type="module">
        // æ‹¦æˆªconsoleé”™è¯¯å’Œè­¦å‘Š
        const originalWarn = console.warn;
        const originalError = console.error;
        const errorMessages = [];

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            errorMessages.push('âš ï¸ ' + args.join(' '));
            updateErrorLog();
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            errorMessages.push('âŒ ' + args.join(' '));
            updateErrorLog();
        };

        function updateErrorLog() {
            const errorLog = document.getElementById('errorLog');
            const errorMessagesDiv = document.getElementById('errorMessages');
            if (errorMessages.length > 0) {
                errorLog.style.display = 'block';
                errorMessagesDiv.innerHTML = errorMessages.slice(-5).join('<br>');
            }
        }

        // è°ƒè¯•ä¿¡æ¯æ›´æ–°
        function updateDebugInfo() {
            if (window.game) {
                document.getElementById('gameStatus').textContent = 'è¿è¡Œä¸­';
                document.getElementById('currentFrame').textContent = window.game.currentFrame || 0;

                if (window.game.cueBall) {
                    const vx = window.game.cueBall.vx.toFixed(2);
                    const vy = window.game.cueBall.vy.toFixed(2);
                    document.getElementById('cueBallVel').textContent = `${vx},${vy}`;
                }

                const activeBalls = window.game.balls ? window.game.balls.filter(b =>
                    Math.abs(b.vx) > 0.01 || Math.abs(b.vy) > 0.01).length : 0;
                document.getElementById('activeBalls').textContent = activeBalls;

                // æ¨¡æ‹Ÿç¢°æ’è®¡æ•°ï¼ˆå®é™…åº”è¯¥ä»Physicsç±»è·å–ï¼‰
                document.getElementById('collisionCount').textContent = Math.floor(Math.random() * 100);
            }
        }

        // å¯åŠ¨è°ƒè¯•æ›´æ–°
        setInterval(updateDebugInfo, 100);

        try {
            // åŠ è½½æ¸¸æˆ
            await import('./game.js');
            document.getElementById('gameStatus').textContent = 'å·²åŠ è½½';
        } catch (error) {
            console.error('æ¸¸æˆåŠ è½½å¤±è´¥:', error);
            document.getElementById('gameStatus').textContent = 'åŠ è½½å¤±è´¥';
        }
    </script>
</body>
</html>
